set schema FN71600?

DROP TABLE FN71600.AIRLINES ?
DROP TABLE FN71600.FLIGHTS ?
DROP TABLE FN71600.SCHEDULES ?
DROP TABLE FN71600.BOOKINGS ?


CREATE TABLE FN71600.AIRLINES
(
    CODE CHAR(2) NOT NULL PRIMARY KEY,
    NAME VARCHAR(20) NOT NULL
)?

/*
За следващата таблица взимам под предвид няколко неща, които добавям
- цената да има максимално 9 символа в себе си (включително и точката)
- стойностите в отделните класи да имат стойност по подразбиране 0
и да не могат да са NULL (един самолет може да няма дадена класа и това
се определя дали е 0 или има някаква стойност <> 0)
ПРЕГЛЕДАЙ ВСИЧКИ ВЪНШНИ ВРЪЗКИ КАК ЩЕ ГИ ТРИЕШ
*/

CREATE TABLE FN71600.FLIGHTS
(
    AIRLINE_CODE CHAR(2) NOT NULL REFERENCES FN71600.AIRLINES(CODE), -- прави се външен ключ към CODE, който е първиче за AIRLINES
    FLIGHT_NUMBER SMALLINT NOT NULL PRIMARY KEY, -- ЗАДА Е 4-ЦИФРЕНО   
    FLIGHT_DATE DATE NOT NULL,
    PRICE DECIMAL(9,2) NOT NULL, -- МАКСИМАЛНО 999999,99
    CURRENCY CHAR(3) NOT NULL DEFAULT 'EUR',
    MAX_ECON_CAP SMALLINT NOT NULL DEFAULT 0 CHECK(MAX_ECON_CAP >= 0),
    OCC_ECON_CAP SMALLINT NOT NULL DEFAULT 0 CHECK(OCC_ECON_CAP >= 0), -- AND OCC_ECON_CAP <= MAX_ECON_CAP),
    MAX_BUSS_CAP SMALLINT NOT NULL DEFAULT 0 CHECK(MAX_BUSS_CAP >= 0),
    OCC_BUSS_CAP SMALLINT NOT NULL DEFAULT 0 CHECK(OCC_BUSS_CAP >= 0), -- AND OCC_BUSS_CAP <= MAX_BUSS_CAP),
    PAYMENTSUM DECIMAL(16, 2) NOT NULL DEFAULT 0.00
)?

ALTER TABLE FN71600.FLIGHTS
	ADD CONSTRAINT FOUR_DIGIT_FLIGHT_NUMBER
	CHECK(FLIGHT_NUMBER >= 1000 AND FLIGHT_NUMBER <= 9999) ?

DROP TABLE FN71600.SCHEDULES ?
CREATE TABLE FN71600.SCHEDULES
(
    AIRLINE_CODE CHAR(2) NOT NULL REFERENCES FN71600.AIRLINES(CODE),
    FLIGHT_NUMBER SMALLINT NOT NULL REFERENCES FN71600.FLIGHTS(FLIGHT_NUMBER),
    DEPT_COUNTRY CHAR(2) NOT NULL,
    DEPT_CITY VARCHAR(20) NOT NULL,
    DEPT_AIRPORT CHAR(3) NOT NULL,
    DEPT_TIME TIME NOT NULL,
    ARRV_COUNTRY CHAR(2) NOT NULL,
    ARRV_CITY VARCHAR(20) NOT NULL,
    ARRV_AIRPORT CHAR(3) NOT NULL,
    ARRV_TIME TIME NOT NULL, -- CHECK(ARRV_TIME >= DEPT_TIME), -- ДАТИТЕ ТРЯБВА ИЛИ ДА СЪВПАДАТ ИЛИ ЕДНАТА ДА Е В БЪДЕЩЕТО
    FLIGHT_TIME SMALLINT CHECK(FLIGHT_TIME > 0),
    DISTANCE SMALLINT CHECK(DISTANCE > 0) -- не е и равно на нула, защото разсотяние 0 е нелогично
)?

ALTER TABLE FN71600.SCHEDULES
	ADD CONSTRAINT PK_COMPOSE
	PRIMARY KEY (AIRLINE_CODE, FLIGHT_NUMBER)
	ADD CONSTRAINT FOUR_DIGIT_FLIGHT_NUMBER_SCHEDULES
	CHECK(FLIGHT_NUMBER >= 1000 AND FLIGHT_NUMBER <= 9999)?
	
CREATE TABLE FN71600.BOOKINGS
(
    AIRLINE_CODE CHAR(2) REFERENCES FN71600.AIRLINES(CODE),
    FLIGHT_NUMBER SMALLINT REFERENCES FN71600.FLIGHTS(FLIGHT_NUMBER), -- ??? ВИЖ ДАЛИ ТРЯБВА ДА ПРАВИШ ПАК ПРОВЕРКА ЗА ЧЕТИРИЦИФРЕНО ЧИСЛО ИЛИ СЕ ХВАЩА ОТ REFERENCES
    BOOKING_NUMBER INT NOT NULL PRIMARY KEY,
    CUSTOMER_NUMBER INT NOT NULL,
    ORDER_DATE DATE NOT NULL -- Виж как ще направиш правилото тук 
)?

ALTER TABLE FN71600.BOOKINGS
	ADD CONSTRAINT EIGHT_DIGIT_BOOKING_NUMBER
	CHECK (BOOKING_NUMBER >= 10000000 AND BOOKING_NUMBER <= 99999999)
	ADD CONSTRAINT EIGHT_DIGIT_CUSTOMER_NUMBER
	CHECK (CUSTOMER_NUMBER >= 10000000 AND CUSTOMER_NUMBER <= 99999999) ?


ALTER TABLE FN71600.SCHEDULES
	ADD CONSTRAINT CHECK_DEPT_TO_ARRV
	CHECK(DEPT_TIME <= ARRV_TIME) ?
	
ALTER TABLE FN71600.FLIGHTS
	ADD CONSTRAINT CHECK_OCC_TO_MAX_BUSS
	CHECK(OCC_BUSS_CAP <= MAX_BUSS_CAP) ? 
	
ALTER TABLE FN71600.FLIGHTS
	ADD CONSTRAINT CHECK_OCC_TO_MAX_ECON
	CHECK(OCC_ECON_CAP <= MAX_ECON_CAP) ?
	
-- triggers for updates
--DROP TRIGGER CHECK_ORDER_DATE ?
--CREATE TRIGGER CHECK_ORDER_DATE
--    BEFORE UPDATE OF ORDER_DATE ON BOOKINGS
--    REFERENCING OLD AS OLD_BOOKING
--    NEW AS NEW_BOOKING
--    FOR EACH ROW MODE DB2SQL
--    WHEN (NEW_BOOKING.ORDER_DATE > (
--        SELECT FS.FLIGHT_DATE
--        FROM FLIGHTS FS
--        WHERE NEW_BOOKING.FLIGHT_NUMBER = FS.FLIGHT_NUMBER
--        AND NEW_BOOKING.AIRLINE_CODE = FS.AIRLINE_CODE
--    ))
--    BEGIN ATOMIC 
--        SIGNAL SQLSTATE '75006'
--            ('INVALID BOOKING ORDER DATE TO DEPT_TIME');
--    END ?
-- CHECK THIS UP
    
CREATE TRIGGER CHECK_ORDER_DATE_TO_FLIGHT_DATE
    BEFORE UPDATE OF ORDER_DATE ON BOOKINGS
    REFERENCING OLD AS OLD_BOOKING
    NEW AS NEW_BOOKING
    FOR EACH ROW MODE DB2SQL
    WHEN (NEW_BOOKING.ORDER_DATE > (
        SELECT FS.FLIGHT_DATE
        FROM FLIGHTS FS
        WHERE NEW_BOOKING.FLIGHT_NUMBER = FS.FLIGHT_NUMBER
        AND NEW_BOOKING.AIRLINE_CODE = FS.AIRLINE_CODE
    ))
    BEGIN ATOMIC 
        SIGNAL SQLSTATE '75005'
            ('INVALID BOOKING ORDER_DATE TO FLIGHT_TIME');
    END ?

-- CREATION OF UNIQUE INDEX FOR AIRLINES 
CREATE UNIQUE INDEX INDEX_AIRLINES
	ON FN71600.AIRLINES(NAME) ?
	
----------------------------------------------HOMEWORK----------------------------------------------------------
SELECT *
FROM FN71600.AIRLINES ?

SELECT *
FROM FN71600.FLIGHTS ?

SELECT *
FROM FN71600.SCHEDULES ?

SELECT *
FROM FN71600.BOOKINGS ?

-- ALTER
ALTER TABLE FN71600.AIRLINES
	ADD COLUMN CURRENCY
	CHAR(3) NOT NULL DEFAULT 'EUR' ?
	
-- ADD COLUMN IN FLIGHTS	
ALTER TABLE FN71600.FLIGHTS
	ADD COLUMN FLIGHT_CODE
	VARCHAR(4) ?
	
-- CHANGE TYPE OF AYMENTSUM
ALTER TABLE FN71600.FLIGHTS
	ALTER COLUMN PAYMENTSUM
	SET DATA TYPE DECIMAL(16,2) ?

-- ADD COLUMN IN BOOKINGS - CUSTOMER_NAME
ALTER TABLE FN71600.BOOKINGS
	ADD COLUMN CUSTOMER_NAME
	VARCHAR(100) ?
	
-- I INSERT DATA FROM DATA STUDIO IMPORT DATA FROM FILE
ALTER TABLE FN71600.SCHEDULES
	DROP CONSTRAINT CHECK_DEPT_TO_ARRV ?

	
-- ADD COLUMN
ALTER TABLE FN71600.BOOKINGS
	ADD COLUMN FCLASS
	SMALLINT DEFAULT 0 ?
	
-- =LOAD DATA AGAIN WITH NEW TABLE
SELECT *
FROM FN71600.BOOKINGS ?


ALTER TABLE FN71600.BOOKINGS
	DROP CONSTRAINT EIGHT_DIGIT_BOOKING_NUMBER
	DROP CONSTRAINT EIGHT_DIGIT_CUSTOMER_NUMBER?
	
INSERT INTO FN71600.BOOKINGS( AIRLINE_CODE, FLIGHT_NUMBER, BOOKING_NUMBER, CUSTOMER_NUMBER, ORDER_DATE, CUSTOMER_NAME, FCLASS)
VALUES 
	('AA',1000,1,3828,'2012-01-16','Lothar Moyano',0),
	('AA',1000,2,1047,'2012-04-08','Irene Jacqmain',0),
	('AA',1000,3,159,'2012-03-18','DEFAULT',0),
	('AA',1000,4,1274,'2012-04-06','Friedrich Rahn',0),
	('AA',1000,5,2873,'2012-03-19','Irene Barth',0),
	('AA',1000,6,2873,'2012-01-05','Irene Barth',0),
	('AA',1000,7,2289,'2012-04-11','Simon Prinz',0),
	('AA',1000,8,1740,'2012-03-21','Florian Neubacher',0),
	('AA',1000,9,1703,'2012-05-05','Achim Mechler',0),
	('AA',1000,10,869,'2012-02-08','Marta Simon',0),
	('AA',1000,11,2997,'2012-03-05','Anne-Marie Pan',0),
	('AA',1000,12,6,'2012-05-07','Starr',0),
	('AA',1000,13,3218,'2012-03-11','Ida Detemple',0),
	('AA',1000,14,1625,'2012-03-23','Florian Ittner',0),
	('AA',1000,15,3641,'2012-04-16','Mathilde Domenech',0),
	('AA',1000,16,3328,'2012-03-15','Anna Matthaeus',0),
	('AA',1000,17,172,'2012-03-02','John Smith',0),
	('AA',1000,18,4041,'2012-02-01','Anna Vrsic',0),
	('AA',1000,19,2800,'2012-01-29','Uli Martin',0),
	('AA',1000,20,3019,'2012-02-06','Hendrik Weiss',0),
	('AA',1000,21,1172,'2012-03-25','Lothar Matthaeus',0),
	('AA',1000,22,1805,'2011-12-31','Salvador Cesari',0),
	('AA',1000,23,494,'2012-03-24','Astrid Hunter',0),
	('AA',1000,24,2646,'2012-03-19','Thomas Oultrement',0),
	('AA',1000,25,4313,'2012-04-25','Cindy Simon',0),
	('AA',1000,26,938,'2012-04-03','Ludwig Heiler',0),
	('AA',1000,27,2731,'2012-04-23','Siegfried Heiler',0),
	('AA',1000,28,3439,'2012-03-17','Thilo Mechler',0),
	('AA',1000,29,2143,'2012-01-01','Friedrich Legrand',0),
	('AA',1000,30,3029,'2012-01-25','Georg Pratt',0),
	('AA',1000,31,2717,'2012-05-11','Johannes Buehler',0),
	('AA',1000,32,2207,'2012-03-03','Hendrik Kreiss',0),
	('AA',1000,33,2779,'2012-02-23','Lee Rahn',0),
	('AA',1000,34,794,'2012-05-12','Ida Rahn',0),
	('AA',1000,35,1647,'2012-02-25','Thomas Jacqmain',0),
	('AA',1000,36,3387,'2012-01-01','Guillermo Barth',0),
	('AA',1000,37,2594,'2012-01-03','Dominik Kramer',0),
	('AA',1000,38,438,'2012-01-12','Jean-Luc Kreiss',0),
	('AA',1000,39,2601,'2011-12-25','Astrid Gahl',0),
	('AA',1000,40,3084,'2012-04-07','Lothar Keller',0),
	('AA',1000,41,2783,'2012-02-18','Mathilde Sessler',0),
	('AA',1000,42,2766,'2012-03-10','James Ittner',0),
	('AA',1000,43,2257,'2012-01-01','Claire Sudhoff',0),
	('AA',1000,44,3493,'2012-01-11','Stephen Ryan',0),
	('AA',1000,45,3434,'2012-03-24','Mathilde Forstmann',0),
	('AA',1000,46,3042,'2012-01-08','Achim Dumbach',0),
	('AA',1000,47,2520,'2012-04-04','Fabio Hoffmann',0),
	('AA',1000,48,1486,'2012-04-25','Fabio Detemple',0),
	('AA',1000,49,1243,'2011-12-27','Lee Trensch',0),
	('AA',1000,50,417,'2012-02-07','Fabio Gahl',0),
	('AA',1000,51,4292,'2012-01-01','Hendrik Wohl',0),
	('AA',1000,52,2832,'2012-05-08','Thomas Picard',0),
	('AA',1000,53,2118,'2012-02-02','Joschka Sisko',0),
	('AA',1000,54,1312,'2012-02-20','Roland Deichgraeber',0),
	('AA',1000,55,562,'2011-12-29','Adam Vrsic',0),
	('AA',1000,56,1920,'2011-12-28','Ruth Benjamin',0),
	('AA',1000,57,3623,'2012-05-10','Anne-Marie Matthaeus',0),
	('AA',1000,58,4217,'2012-04-04','Irene Vrsic',0),
	('AA',1000,59,928,'2012-04-15','Lee Jacqmain',0),
	('AA',1000,60,1010,'2012-01-04','Guenther Kirk',0),
	('AA',1000,61,3939,'2012-01-18','Lothar Ryan',0),
	('AA',1000,62,3023,'2012-02-01','Illya Gahl',0),
	('AA',1000,63,3158,'2012-01-06','Gisela Legrand',0),
	('AA',1000,64,1505,'2012-04-01','Ida Moyano',0),
	('AA',1000,65,1408,'2012-03-12','Cindy Schneider',0),
	('AA',1000,66,1408,'2012-05-05','Cindy Schneider',0),
	('AA',1000,67,2116,'2012-02-04','Chantal Buehler',0),
	('AA',1000,68,3439,'2012-03-18','Thilo Mechler',0),
	('AA',1000,69,1836,'2012-04-11','Adam Kirk',0),
	('AA',1000,70,1738,'2012-03-24','Amelie Pratt',0),
	('AA',1000,71,2525,'2012-03-30','Lothar Columbo',0),
	('AA',1000,72,4010,'2012-03-11','Marta Keller',0),
	('AA',1000,73,1886,'2012-02-09','Peter Rahn',0),
	('AA',1000,74,1746,'2012-03-13','Jean-Luc Buchholz',0),
	('AA',1000,75,3085,'2012-04-06','Siegfried Pan',0),
	('AA',1000,76,4119,'2012-03-16','Marta Rahn',0),
	('AA',1000,77,4321,'2012-04-15','Hendrik Vrsic',0),
	('AA',1000,78,356,'2012-04-23','Pierre Dumbach',0),
	('AA',1000,79,3224,'2012-03-04','Siegfried Forstmann',0),
	('AA',1000,80,1086,'2012-02-20','Claire Hansmann',0),
	('AA',1000,81,1277,'2012-04-03','Pierre Moyano',0),
	('AA',1000,82,3331,'2012-03-12','Laura Goerke',0),
	('AA',1000,83,243,'2012-04-24',NULL,0),
	('AA',1000,84,2662,'2012-02-29','Sophie Sommer',0),
	('AA',1000,85,2726,'2012-04-30','Horst Detemple',0),
	('AA',1000,86,3739,'2012-05-06','Guillermo Bentink',0),
	('AA',1000,87,4615,'2012-01-22','Theresia Forstmann',0),
	('AA',1000,88,2289,'2012-04-10','Simon Prinz',0),
	('AA',1000,89,2699,'2012-01-13','Theresia Pan',0),
	('AA',1000,90,227,'2011-12-25',NULL,0),
	('AA',1000,91,3777,'2012-03-20','August Fischer',0),
	('AA',1000,92,3706,'2012-01-27','Fabio Babilon',0),
	('AA',1000,93,849,'2012-03-04','Anneliese D?Oultrement',0),
	('AA',1000,94,1530,'2012-02-29','Lothar Simon',0),
	('AA',1000,95,2067,'2012-04-05','Christa Trensch',0),
	('AA',1000,96,163,'2012-03-14',NULL,0),
	('AA',1000,97,2744,'2012-04-07','Torben Madeya',0),
	('AA',1000,98,1746,'2012-03-14','Jean-Luc Buchholz',0),
	('AA',1000,99,1956,'2012-04-03','Horst Forstmann',0),
	('AA',1000,100,2807,'2012-01-20','Anne-Marie Meier',0),
	('AA',1000,101,313,'2012-01-27',NULL,0),
	('AA',1000,102,525,'2012-02-14','Sophie D?Oultrement',0),
	('AA',1000,103,4210,'2012-04-12','Mathilde A. Detemple',0),
	('AA',1000,104,4573,'2012-03-14','Gisela Miguel',0),
	('AA',1000,105,1636,'2012-03-10','Thomas Vrsic',0),
	('AA',1000,106,3148,'2012-01-18','Lothar Koslowski',0),
	('AA',1000,107,3184,'2012-04-23','Lee Martin',0),
	('AA',1000,108,3419,'2012-04-12','Uli Leisert',0),
	('AA',1000,109,4270,'2012-01-29','Johannes Sudhoff',0),
	('AA',1000,110,3116,'2012-02-27','Achim Ittner',0),
	('AA',1000,111,850,'2012-03-03','Adam Bentink',0),
	('AA',1000,112,2825,'2011-12-29','Allen Schneider',0),
	('AA',1000,113,2945,'2012-05-09','Achim Hansmann',0),
	('AA',1000,114,348,'2012-05-03','Salvador Heiler',0),
	('AA',1000,115,3976,'2012-04-23','Claire Gueldenpfennig',0),
	('AA',1000,116,4169,'2012-01-14','Johannes Prinz',0),
	('AA',1000,117,4169,'2012-05-02','Johannes Prinz',0),
	('AA',1000,118,308,'2012-02-02',NULL,0),
	('AA',1000,119,1760,'2012-02-25','Torben Benjamin',0),
	('AA',1000,120,2992,'2012-03-12','Guenther Forstmann',0),
	('AA',1000,121,677,'2011-12-28','Annemarie Miguel',0),
	('AA',1000,122,4448,'2012-03-29','Thomas Kreiss',0),
	('AA',1000,123,391,'2012-03-11','Florian D?Oultrement',0),
	('AA',1000,124,1209,'2012-02-07','Adam Martin',0),
	('AA',1000,125,77,'2012-02-09',NULL,0),
	('AA',1000,126,1914,'2012-01-05','Benjamin Dumbach',0),
	('AA',1000,127,2403,'2012-04-09','Christine Jeremias',0),
	('AA',1000,128,4302,'2012-05-09','Salvador Hansmann',0),
	('AA',1000,129,219,'2012-01-03',NULL,0),
	('AA',1000,130,4583,'2012-03-02','Peter Montero',0),
	('AA',1000,131,348,'2012-05-04','Salvador Heiler',0),
	('AA',1000,132,2997,'2012-03-05','Anne-Marie Pan',0),
	('AA',1000,133,4299,'2012-05-13','Carmel Jacqmain',0),
	('AA',1000,134,624,'2012-03-02','Allen Meier',0),
	('AA',1000,135,3834,'2012-01-09','Thilo Leisert',0),
	('AA',1000,136,1657,'2012-02-13','Gerd Lindwurm',0),
	('AA',1000,137,979,'2012-02-12','Salvador D?Oultrement',0),
	('AA',1000,138,1895,'2012-01-29','Guillermo Schneider',0),
	('AA',1000,139,2716,'2012-05-12','Irmgard Lautenbach',0),
	('AA',1000,140,977,'2012-02-14','Achim Kramer',0),
	('AA',1000,141,3744,'2012-04-29','Anne-Marie Heiler',0),
	('AA',1000,142,4548,'2012-04-14','Chantal Zimmermann',0),
	('AA',1000,143,2353,'2012-01-21','Andreas Lindwurm',0),
	('AA',1000,144,3765,'2012-04-03','Joschka Barth',0),
	('AA',1000,145,3148,'2012-01-17','Lothar Koslowski',0),
	('AA',1000,146,89,'2012-01-25',NULL,0),
	('AA',1000,147,3643,'2012-04-15','Juan Picard',0),
	('AA',1000,148,1041,'2012-04-16','Andreas Ittner',0),
	('AA',1000,149,4130,'2012-03-02','Gisela Fischer',0),
	('AA',1000,150,3752,'2012-04-20','Ulla Zimmermann',0),
	('AA',1000,151,3472,'2012-02-05','Ida Madeya',0),
	('AA',1000,152,1873,'2012-02-25','Dominik Miguel',0),
	('AA',1000,153,3691,'2012-02-15','Guillermo Eichbaum',0),
	('AA',1000,154,2962,'2012-04-18','Claire Hoffmann',0),
	('AA',1000,155,1107,'2012-01-24','Friedrich Heiler',0),
	('AA',1000,156,4445,'2012-04-01','Salvador Miguel',0),
	('AA',1000,157,898,'2012-01-03','Lothar Picard',0),
	('AA',1000,158,541,'2012-01-25','Peter Henry',0),
	('AA',1000,159,2983,'2012-03-23','Friedrich Zimmermann',0),
	('AA',1000,160,4239,'2012-03-07','Sophie Fischer',0),
	('AA',1000,161,2282,'2012-04-20','Ulla Miguel',0),
	('AA',1000,162,3653,'2012-04-01','Johannes Martin',0),
	('AA',1000,163,327,'2012-01-09','DEFAULT',0),
	('AA',1000,164,1065,'2012-03-17','Stephen Henry',0),
	('AA',1000,165,2862,'2012-04-01','Fabio Sommer',0),
	('AA',1000,166,1608,'2012-04-14','Astrid Forstmann',0),
	('AA',1000,167,2398,'2012-04-16','James Trensch',0),
	('AA',1000,168,4485,'2012-02-12','Amelie Picard',0),
	('AA',1000,169,1684,'2012-01-09','Anneliese Schneider',0),
	('AA',1000,170,1371,'2012-04-27','Fabio Henry',0),
	('AA',1000,171,3284,'2012-05-09','Thomas Pan',0),
	('AA',1000,172,1203,'2012-02-15','Laura Babilon',0),
	('AA',1000,173,3169,'2012-05-12','Sophie Sisko',0),
	('AA',1000,174,1720,'2012-04-15','Gerd Matthaeus',0),
	('AA',1000,175,360,'2012-04-19','Andreas Jacqmain',0),
	('AA',1000,176,245,'2012-04-20','DEFAULT',0),
	('AA',1000,177,2785,'2012-02-16','Hendrik Trensch',0),
	('AA',1000,178,772,'2012-01-19','Georg Kramer',0),
	('AA',1000,179,2207,'2012-03-03','Hendrik Kreiss',0),
	('AA',1000,180,2529,'2012-03-24','Marta Neubacher',0),
	('AA',1000,181,2415,'2012-03-26','Johannes Leisert',0),
	('AA',1000,182,292,'2012-02-22','DEFAULT',0),
	('AA',1000,183,2195,'2012-03-17','Anneliese Pratt',0),
	('AA',1000,184,2088,'2012-03-10','Achim Cesari',0),
	('AA',1000,185,2660,'2012-03-02','Andrej Ryan',0),
	('AA',1000,186,240,'2012-04-27','DEFAULT',0),
	('AA',1000,187,2851,'2012-04-15','Chantal Henry',0),
	('AA',1000,188,1232,'2012-01-09','Lee Matthaeus',0),
	('AA',1000,189,1159,'2012-04-09','Christa Goerke',0),
	('AA',1000,190,3783,'2012-03-11','Jean-Luc Leisert',0),
	('AA',1000,191,807,'2012-04-25','Marta Wohl',0),
	('AA',1000,192,1671,'2012-01-26','Theresia Madeya',0),
	('AA',1000,193,1474,'2012-05-09','Georg Fischer',0),
	('AA',1000,194,576,'2012-05-01','Andreas Henry',0),
	('AA',1000,195,1695,'2011-12-28','August Henry',0),
	('AA',1000,196,4379,'2012-02-03','Marta Leisert',0),
	('AA',1000,197,881,'2012-01-24','Lothar Pratt',0),
	('AA',1000,198,71,'2012-02-16','DEFAULT',0),
	('AA',1000,199,965,'2012-02-29','Christine Martin',0),
	('AA',1000,200,1952,'2012-04-07','Ludwig Jeremias',0)
	?
-- VIEWS
--Създайте изглед, който извежда име на авикомпания, номер на полет, 
--дата на полет, цена на билет и държава и град на излитане според разписанието.
CREATE VIEW FN71600.V_SCHEDULE
	AS 
		SELECT ALS.NAME, FS.FLIGHT_NUMBER, FS.FLIGHT_DATE, FS.PRICE, SS.DEPT_CITY
		FROM FN71600.AIRLINES ALS, FN71600.FLIGHTS FS, FN71600.SCHEDULES SS
		WHERE ALS.CODE = FS.AIRLINE_CODE
		AND FS.FLIGHT_NUMBER = SS.FLIGHT_NUMBER
	?
	
CREATE VIEW FN71600.V_COMPANY_PAYMENTSUM
	AS
		SELECT ALS.NAME, COUNT(*) AS COUNT_NUMBER, SUM(FS.PAYMENTSUM) AS ALL_PAY
		FROM FN71600.AIRLINES ALS, FN71600.FLIGHTS FS, FN71600.BOOKINGS BS
		WHERE ALS.CODE = FS.AIRLINE_CODE
		AND FS.FLIGHT_NUMBER = BS.FLIGHT_NUMBER
		GROUP BY ALS.NAME
	?
	
DROP VIEW FN71600.V_SCHEDULE?
SELECT *
FROM FN71600.V_COMPANY_PAYMENTSUM?

-- TRIGGERS
DROP TRIGGER FN71600.CHECK_ORDER_DATE_TO_FLIGHT_DATE ?

CREATE TRIGGER FN71600.CHECK_ORDER_DATE_TO_FLIGHT_DATE
    BEFORE UPDATE ON BOOKINGS
    REFERENCING OLD AS OLD_BOOKING
    NEW AS NEW_BOOKING
    FOR EACH ROW MODE DB2SQL
    WHEN (NEW_BOOKING.ORDER_DATE > (
        SELECT FS.FLIGHT_DATE
        FROM FN71600.FLIGHTS FS
        WHERE NEW_BOOKING.FLIGHT_NUMBER = FS.FLIGHT_NUMBER
        	AND NEW_BOOKING.AIRLINE_CODE = FS.AIRLINE_CODE
    ))
    BEGIN ATOMIC 
        SIGNAL SQLSTATE '75005'
            ('INVALID BOOKING ORDER_DATE TO FLIGHT_TIME');
    END ?
    
CREATE TRIGGER FN71600.CHECK_INSERT
    BEFORE INSERT ON FN71600.BOOKINGS
    REFERENCING NEW AS NEW_BOOKING
    FOR EACH ROW MODE DB2SQL
    WHEN (NEW_BOOKING.ORDER_DATE > (
        SELECT FS.FLIGHT_DATE
        FROM FN71600.FLIGHTS FS
        WHERE NEW_BOOKING.FLIGHT_NUMBER = FS.FLIGHT_NUMBER
--        	AND NEW_BOOKING.AIRLINE_CODE = FS.AIRLINE_CODE
    ))
    BEGIN ATOMIC 
        SIGNAL SQLSTATE '75005'
            ('INVALID BOOKING ORDER_DATE TO FLIGHT_TIME');
    END ?
    
select *
from fn71600.schedules?    

UPDATE FN71600.BOOKINGS
SET ORDER_DATE = '2019-12-27'
WHERE AIRLINE_CODE = 'AA'
AND FLIGHT_NUMBER = 1000
AND CUSTOMER_NUMBER = 159
?
--
--ALTER TABLE FN71600.BOOKINGS
--INSERT 
SELECT *
FROM FN71600.FLIGHTS